<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trust Admin Diagnostics</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1e3a5f;
            border-bottom: 3px solid #c9a961;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 5px;
            border-left: 4px solid #c9a961;
        }
        button {
            background: #1e3a5f;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #2a4a6f;
        }
        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .info {
            background: #cce5ff;
            color: #004085;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .log-entry {
            padding: 5px;
            margin: 2px 0;
            background: #f9f9f9;
            border-left: 3px solid #ddd;
        }
        .log-success { border-left-color: #28a745; }
        .log-error { border-left-color: #dc3545; }
        .log-info { border-left-color: #17a2b8; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Trust Administration App - Diagnostics</h1>
        
        <div class="test-section">
            <h2>üß™ Quick Function Tests</h2>
            
            <button onclick="testSimple()">1. Test Simple Function</button>
            <button onclick="testCreateCase()">2. Test Create Case</button>
            <button onclick="testBOEForms()">3. Test BOE Forms</button>
            <button onclick="checkAllEndpoints()">4. Check All Endpoints</button>
        </div>

        <div class="test-section">
            <h2>üìä Results</h2>
            <div id="results"></div>
        </div>

        <div class="test-section">
            <h2>üìù Debug Log</h2>
            <div id="debug-log"></div>
        </div>
    </div>

    <script>
        function addLog(message, type = 'info') {
            const logDiv = document.getElementById('debug-log');
            const entry = document.createElement('div');
            entry.className = 'log-entry log-' + type;
            entry.innerHTML = '[' + new Date().toLocaleTimeString() + '] ' + message;
            logDiv.appendChild(entry);
        }

        function showResult(message, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const result = document.createElement('div');
            result.className = type;
            result.innerHTML = message;
            resultsDiv.appendChild(result);
        }

        async function testSimple() {
            addLog('Testing simple function...', 'info');
            try {
                const response = await fetch('/.netlify/functions/test-function');
                const data = await response.json();
                showResult('‚úÖ Simple function works: ' + data.message, 'success');
                addLog('Response: ' + JSON.stringify(data), 'success');
            } catch (error) {
                showResult('‚ùå Simple function failed: ' + error.message, 'error');
                addLog('Error: ' + error.message, 'error');
            }
        }

        async function testCreateCase() {
            addLog('Testing create-trust-case...', 'info');
            try {
                const response = await fetch('/.netlify/functions/create-trust-case', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        decedent_first_name: 'Test',
                        decedent_last_name: 'User',
                        death_date: '2024-01-15',
                        trustee_name: 'Test Trustee',
                        trust_name: 'Test Trust'
                    })
                });
                const data = await response.json();
                if (data.success) {
                    showResult('‚úÖ Create case works! Case #: ' + data.case_number, 'success');
                } else {
                    showResult('‚ùå Create case failed: ' + (data.error || data.details), 'error');
                }
                addLog('Response: ' + JSON.stringify(data), data.success ? 'success' : 'error');
            } catch (error) {
                showResult('‚ùå Create case error: ' + error.message, 'error');
                addLog('Error: ' + error.message, 'error');
            }
        }

        async function testBOEForms() {
            addLog('Testing BOE forms generation...', 'info');
            try {
                const response = await fetch('/.netlify/functions/generate-boe-forms', {
                    method: 'OPTIONS'
                });
                if (response.ok || response.status === 405) {
                    showResult('‚úÖ BOE forms endpoint exists (status: ' + response.status + ')', 'success');
                } else {
                    showResult('‚ùå BOE forms endpoint error: ' + response.status, 'error');
                }
            } catch (error) {
                showResult('‚ùå BOE forms error: ' + error.message, 'error');
            }
        }

        async function checkAllEndpoints() {
            const endpoints = [
                'test-function',
                'create-trust-case',
                'generate-boe-forms',
                'generate-government-notices',
                'generate-property-documents',
                'generate-trust-documents',
                'generate-distribution-docs'
            ];
            
            addLog('Checking all endpoints...', 'info');
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch('/.netlify/functions/' + endpoint, {
                        method: 'OPTIONS'
                    });
                    if (response.ok || response.status === 405) {
                        addLog('‚úÖ ' + endpoint + ' is accessible', 'success');
                    } else {
                        addLog('‚ùå ' + endpoint + ' returned ' + response.status, 'error');
                    }
                } catch (error) {
                    addLog('‚ùå ' + endpoint + ' failed: ' + error.message, 'error');
                }
            }
            
            showResult('Endpoint check complete. See log for details.', 'info');
        }

        window.addEventListener('DOMContentLoaded', () => {
            addLog('Diagnostics loaded', 'success');
            addLog('Site URL: ' + window.location.origin, 'info');
            addLog('Click the test buttons above to check each function', 'info');
        });
    </script>
</body>
</html>
